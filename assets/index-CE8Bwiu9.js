import{a as e,c as s,r as t,j as r,L as n}from"./index-dWbV2YWN.js";import{u as a}from"./copytoclipboard-Cy7DO2po.js";import{c as i,B as o}from"./button-BYsJFizr.js";import{n as d,o as l,c,C as u,f as m,l as p}from"./endpoints-C8SDwtyd.js";import{L as h}from"./loading-DZKuFaBE.js";import{Q as b}from"./MarkupRenderer-CugZClZz.js";import{u as x}from"./StateUtil-moXfkR8g.js";import{C as j}from"./table_util-DcgUt5Gf.js";import{u as g}from"./SessionContext-UTYWUXxA.js";import{A as f}from"./apiform-Cee87rao.js";import"./SimpleChart-CDY-4U1s.js";import"./theme-provider-UldqYbSh.js";import"./input-hcSfkvL2.js";import"./bulkwrapper-lVatfgrI.js";import"./useSuspenseQuery-C4hISphF.js";import"./useQuery-DQU7waJ6.js";function N(){const{nation:n}=e(),{session:a,error:i,setSession:o,refetchSession:c}=g(),[u,m]=x(n??(null==a?void 0:a.nation_name)),p=s();t.useEffect((()=>{n&&m((e=>e!==n?n:e))}),[n,m]),t.useEffect((()=>{(null==a?void 0:a.nation_name)&&!n&&m((e=>e!==a.nation_name?a.nation_name:e))}),[a,n,m]);const h=t.useCallback((e=>{m(e),p(`/raid/${e}`)}),[p,m]),[b,j]=t.useState(null),[f,N]=t.useState(null),y=t.useMemo((()=>({app_7d:{endpoint:l,default_values:{nations:"*,#position<=1",num_results:"25"},description:"Attackable applicants and nones inactive for 7d"},members:{endpoint:l,default_values:{nations:"*",num_results:"25"},description:"All attackable nations inactive for 7d"},beige:{endpoint:l,default_values:{nations:"*",num_results:"25",beige_turns:"24"},description:"All nations inactive for 7d, including on beige"},ground:{endpoint:l,default_values:{nations:"#tankpct<0.2,#soldierpct<0.4,*",num_results:"25",time_inactive:"0d",weak_ground:"true"},description:"Nations with weak ground, including active nations"},ground_2d:{endpoint:l,default_values:{nations:"#tankpct<0.2,#soldierpct<0.4,*",num_results:"25",time_inactive:"2d",weak_ground:"true"},description:"Nations with weak ground, inactive for 2d"},losing:{endpoint:l,default_values:{nations:"#def>0,#RelativeStrength<1,*",num_results:"25",time_inactive:"0d",weak_ground:"true"},description:"Nations losing wars"},unprotected:{endpoint:d,default_values:{nations:"*",num_results:"25",ignoreODP:"true",includeAllies:"true",maxRelativeCounterStrength:"90"},description:"Nations least likely to defend or have counters"}})),[]),k=t.useMemo((()=>r.jsx(_,{pickedNation:u,updateNation:h})),[u,h]),S=t.useMemo((()=>Object.keys(y).map(((e,s)=>r.jsx("span",{children:r.jsx(v,{label:e,option:y[e],endpoint:y[e].endpoint,setDesc:N,setRaidOutput:j,nation:u??"",loading:!1})},s)))),[u,y]),C=t.useMemo((()=>f&&r.jsx("div",{className:"p-1 bg-primary/10",children:f})),[f]),M=t.useCallback((()=>{j(null),N("")}),[j,N]),R=t.useMemo((()=>r.jsx(w,{output:b,dismiss:M})),[b,M]);return r.jsxs("div",{className:"bg-light/10 border border-light/10 p-2 rounded mt-2",children:[r.jsx("h1",{className:"text-2xl mt-2 font-bold",children:"War / Raiding"}),(!a||!a.nation)&&!u&&k,r.jsxs("div",{className:"p-2 my-1 relative",children:["Raiding: ",u&&S,r.jsx("br",{}),C,R]})]})}function _({pickedNation:e,updateNation:s}){const n=t.useCallback(((e,t)=>{s(t)}),[s]);return r.jsxs(r.Fragment,{children:[r.jsx("div",{className:(e?"text-primary/80 border-secondary":"text-red-500 border-red-500/25")+" border w-full mb-1 p-1 relative bg-accent rounded",children:e?r.jsxs(r.Fragment,{children:["Currently selected: ",e]}):r.jsx(r.Fragment,{children:"You MUST Select a Nation to use this tool or add it to the url or login."})}),r.jsx(b,{element:"DBNation",multi:!1,argName:"nation",initialValue:e??"",setOutputValue:n})]})}function v({option:e,label:s,endpoint:n,setRaidOutput:o,loading:d,setDesc:l,nation:c}){const{showDialog:u}=a(),m=t.useMemo((()=>({...e.default_values,nation:c})),[e,c]),p=t.useCallback((({data:s})=>{l(e.description),o(!0),o(s)}),[e,l,o]),h=t.useCallback((e=>{o(null),u("Error",e.message,!0)}),[o,u]),b=t.useMemo((()=>i("mb-1 border-primary/20",{"cursor-wait disabled text-muted":d})),[d]);return r.jsx(f,{endpoint:n,default_values:m,label:s,handle_response:p,handle_error:h,classes:b})}function y({options:e,setRaidOutput:s,loading:n,desc:o,setDesc:l}){const{showDialog:c}=a(),u=t.useCallback((({data:e})=>{l("Unprotected Nations"),s(!0),s(e)}),[l,s]),m=t.useCallback((e=>{s(null),c("Error",e.message,!0)}),[s,c]),p=t.useMemo((()=>i("mb-1 border-primary/20",{"cursor-wait disabled text-muted":n})),[n]);return r.jsx(f,{endpoint:d,default_values:e,label:"unprotected",handle_response:u,handle_error:m,classes:p})}const k=u.options.Rank.options.map((e=>"REMOVE"===e?"":e));function w({output:e,dismiss:s}){if(!e)return r.jsx(r.Fragment,{});if(!0===e)return r.jsx(h,{variant:"ripple"});const n=e,a=t.useMemo((()=>r.jsxs("tr",{children:[r.jsx("th",{children:"Name"}),r.jsx("th",{children:"Alliance"}),r.jsx("th",{}),n.include_strength&&r.jsx("th",{children:"Strength"}),r.jsx("th",{children:"Loot"}),r.jsx("th",{children:"Rank"}),r.jsx("th",{children:"Active"}),r.jsx("th",{children:"ðŸ’‚"}),r.jsx("th",{children:"âš™"}),r.jsx("th",{children:"âœˆ"}),r.jsx("th",{children:"ðŸš¢"}),r.jsx("th",{children:"ðŸ”Ž"}),r.jsx("th",{children:"ðŸš€"}),r.jsx("th",{children:"â˜¢"}),r.jsx("th",{children:"Score"}),r.jsx("th",{children:"Infra"})]})),[n.include_strength]),i=t.useMemo((()=>[n.self,...n.targets].map(((e,s)=>r.jsx(S,{includeStrength:n.include_strength,now:Date.now(),self:n.self,target:e,classes:"even:bg-black/10 dark:even:bg-white/5 "+(e.id===n.self.id?"border border-2 border-blue-500/50 bg-blue-500/20":"")},s)))),[n]);return r.jsxs("div",{className:"w-full",children:[r.jsxs("table",{className:"w-full text-sm table-auto",children:[r.jsx("thead",{className:"text-left",children:a}),r.jsx("tbody",{children:i})]}),r.jsx(o,{onClick:s,variant:"outline",size:"sm",className:"w-full",children:"Dismiss"})]})}function S({includeStrength:e,self:s,target:t,classes:a,now:i}){return r.jsxs("tr",{className:a,children:[r.jsx("td",{className:"border border-gray-500/25 p-1",children:t.id==s.id?"Your Nation":r.jsx(n,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/nation/id=${t.id}`,children:t.nation})}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:t.id==s.id?"":0===t.alliance_id?"None":r.jsx(n,{className:"text-blue-600 hover:text-blue-800 underline",to:`https://politicsandwar.com/alliance/id=${t.alliance_id}`,children:t.alliance})}),r.jsx("td",{className:"border border-gray-500/25",children:r.jsx("div",{className:"flex justify-center items-center text-center",children:r.jsx(j,{colorId:t.color_id,beigeTurns:t.beige_turns})})}),e&&r.jsx("td",{className:"border-0.5border border-gray-500/25 p-1",children:t.id!=s.id?`${c(t.strength)}%`:""}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:t.id==s.id?"":`$${0!=t.expected&&t.expected!=t.actual?c(t.expected)+"-":""}${c(t.actual)}`}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:k[t.position]}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:m(Math.round((i-t.active_ms)/1e3),2)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.soldier)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.tank)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.aircraft)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.ship)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.spies)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.missile)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.nuke)}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(Math.round(t.avg_infra))}),r.jsx("td",{className:"border border-gray-500/25 p-1",children:p(t.score)})]})}export{_ as PickNation,v as RaidButton,w as RaidOutput,y as UnprotectedButton,S as WebTargetRow,N as default};
