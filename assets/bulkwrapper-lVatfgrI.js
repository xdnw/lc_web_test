import{r,j as e,u as t}from"./index-dWbV2YWN.js";import{d as n,B as s}from"./button-BYsJFizr.js";import{u as o}from"./useSuspenseQuery-C4hISphF.js";import{L as a}from"./loading-DZKuFaBE.js";import{O as i}from"./endpoints-C8SDwtyd.js";const c=r.createContext(null),d={didCatch:!1,error:null};class l extends r.Component{constructor(r){super(r),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=d}static getDerivedStateFromError(r){return{didCatch:!0,error:r}}resetErrorBoundary(){const{error:r}=this.state;if(null!==r){for(var e,t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];null===(e=(t=this.props).onReset)||void 0===e||e.call(t,{args:s,reason:"imperative-api"}),this.setState(d)}}componentDidCatch(r,e){var t,n;null===(t=(n=this.props).onError)||void 0===t||t.call(n,r,e)}componentDidUpdate(r,e){const{didCatch:t}=this.state,{resetKeys:n}=this.props;var s,o;t&&null!==e.error&&function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r.length!==e.length||r.some(((r,t)=>!Object.is(r,e[t])))}(r.resetKeys,n)&&(null===(s=(o=this.props).onReset)||void 0===s||s.call(o,{next:n,prev:r.resetKeys,reason:"keys"}),this.setState(d))}render(){const{children:e,fallbackRender:t,FallbackComponent:n,fallback:s}=this.props,{didCatch:o,error:a}=this.state;let i=e;if(o){const e={error:a,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)i=t(e);else if(n)i=r.createElement(n,e);else{if(void 0===s)throw a;i=s}}return r.createElement(c.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},i)}}function u(e){const[t,s]=r.useState(e);return r.useEffect((()=>{n(e,t)||s(e)}),[e,t]),t}function p({endpoint:t,args:n,handle_error:s,batch_wait_ms:o,isPostOverride:i,children:c}){const d=u(n?Object.fromEntries(Object.entries(n).filter((([r,e])=>void 0!==e))):{}),p=r.useCallback((r=>function({error:r,resetErrorBoundary:t,endpoint:n,query:s}){return e.jsx(h,{endpoint:n,query:s,error:r,resetErrorBoundary:t})}({...r,endpoint:t.endpoint.name,query:d})),[t.endpoint.name,d]);return e.jsx(l,{fallbackRender:p,onError:s??console.error,children:e.jsx(r.Suspense,{fallback:e.jsx(a,{variant:"ripple"}),children:e.jsx(m,{endpoint:t.endpoint,query:d,is_post:i??t.endpoint.isPost,cache_duration:t.endpoint.cache_duration,batch_wait_ms:o,children:r=>c(r)})})})}function h({endpoint:n,query:o,error:a,resetErrorBoundary:i}){const c=t(),d=r.useCallback((()=>{c.removeQueries({queryKey:[n,o]}),i()}),[c,n,o,i]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{role:"alert",className:"whitespace-pre-wrap bg-accent relative px-2 border-2 border-destructive",children:e.jsxs("pre",{className:"whitespace-pre-wrap break-all",children:[a.name,": ",a.message]})}),e.jsx(s,{size:"sm",variant:"outline",onClick:d,children:"Try again"})]})}function m({endpoint:r,query:e,is_post:t,cache_duration:n,batch_wait_ms:s,children:a}){const{data:c}=o(i(r,e,t,n,s));return a(c)}export{p as E,u};
