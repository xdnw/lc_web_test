import{a as e,j as s,r as a,L as r}from"./index-dWbV2YWN.js";import{k as n,C as t,L as l,W as i,l as c}from"./endpoints-C8SDwtyd.js";import{B as d}from"./button-BYsJFizr.js";import{d as o,B as m}from"./copytoclipboard-Cy7DO2po.js";import{L as h}from"./loading-DZKuFaBE.js";import{E as x}from"./bulkwrapper-lVatfgrI.js";import{A as j}from"./apiform-Cee87rao.js";import"./useSuspenseQuery-C4hISphF.js";import"./StateUtil-moXfkR8g.js";import"./MarkupRenderer-CugZClZz.js";import"./SimpleChart-CDY-4U1s.js";import"./theme-provider-UldqYbSh.js";import"./input-hcSfkvL2.js";import"./table_util-DcgUt5Gf.js";import"./useQuery-DQU7waJ6.js";function u(){const{category:a}=e();return s.jsx(x,{endpoint:n,args:{},children:({data:e})=>s.jsx(N,{balance:e})})}const b=t.options.ResourceType.options;function g(e){const s=Object.fromEntries(b.map(((s,a)=>[s,e[a]])).filter((([,e])=>0!==e)));return JSON.stringify(s)}const p=()=>s.jsxs(s.Fragment,{children:[s.jsx(d,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(r,{to:"/guild_member",children:[s.jsx(l,{name:"ChevronLeft",className:"h-4 w-4"}),"Back"]})}),s.jsx("h1",{className:"text-2xl font-bold",children:"Balance"})]}),f=({balance:e,canWithdraw:r,amount:n,handleAmountChange:t})=>{const l=a.useMemo((()=>s.jsxs("tr",{children:[s.jsx("th",{className:"border border-gray-200",children:"Resource Type"}),s.jsx("th",{className:"border border-gray-200",children:"Value"}),r&&s.jsx("th",{className:"border border-gray-200",children:"Amount"})]})),[r]),i=a.useCallback((e=>{const s=parseInt(e.target.dataset.key||"0",10),a=parseInt(e.target.value,10)||0;t(s,a)}),[t]);return s.jsxs("table",{className:"table-auto divide-y bg-background",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:l}),s.jsx("tbody",{children:b.map(((a,t)=>"CREDITS"!==a&&s.jsxs("tr",{children:[s.jsx("td",{className:"border border-gray-200 px-1",children:a}),s.jsx("td",{className:"border border-gray-200 px-1",children:c(e.total[t])}),r&&s.jsx("td",{className:"border border-gray-200",children:s.jsx("input",{"data-key":t,type:"number",className:"px-1 w-20 relative",value:n[t],onChange:i})})]},a)))})]})},v=({balance:e,showBreakdown:r})=>{const n=a.useMemo((()=>s.jsxs("tr",{children:[s.jsx("th",{className:"border border-gray-200",children:"Category"}),b.map((e=>s.jsx("th",{className:"border border-gray-200",children:e},e)))]})),[]);return s.jsx("div",{className:"transition-all duration-200 ease-in-out "+(r?"p-1 max-h-screen opacity-100":"max-h-0 opacity-0 overflow-hidden"),children:s.jsxs("table",{className:"table-auto divide-y w-full bg-background",children:[s.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:n}),s.jsx("tbody",{children:Object.keys(e.breakdown).map((a=>s.jsxs("tr",{children:[s.jsx("td",{className:"border border-gray-200 px-1",children:a}),e.breakdown[a].map(((e,r)=>s.jsx("td",{className:"border border-gray-200 px-1",children:c(e)},`${a}-${r}`)))]},a)))})]})})},y=({amount:e,qualifiedId:r,balance:n})=>{const t=a.useRef(null),l=a.useMemo((()=>`/transfer resources receiver:${r} transfer:${g(e)} deposittype:${n.is_aa?"IGNORE":"DEPOSIT"}`),[e,r,n.is_aa]),i=a.useCallback((()=>t.current?t.current.textContent??"":""),[t]);return s.jsxs("div",{className:"p-1 bg-accent relative",children:[s.jsx("h4",{className:"text-lg font-bold",children:"Discord Withdraw Command"}),s.jsx(o,{children:s.jsx(m,{getText:i})}),s.jsx("p",{ref:t,children:l})]})};function N({balance:e}){const[n,t]=a.useState(!1),i=a.useMemo((()=>e.access&&Object.keys(e.access).length>0),[e.access]),[c,o]=a.useState(new Array(b.length).fill(0)),[m,x]=a.useState(!1),[j,u]=a.useState(null),g=a.useCallback((()=>{t((e=>!e))}),[]),N=a.useCallback(((e,s)=>{o((a=>{const r=[...a];return r[e]=s,r}))}),[]),w=a.useMemo((()=>(e.is_aa?"AA:":"")+e.id),[e.is_aa,e.id]);return m?s.jsx(h,{variant:"ripple"}):j||s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mb-1",children:[s.jsx(p,{}),s.jsxs("div",{className:"inline-block",children:[s.jsxs("div",{className:"inline-block flex",children:[s.jsx(f,{balance:e,canWithdraw:i,amount:c,handleAmountChange:N}),i&&s.jsx(k,{setReactMessage:u,setLoading:x,balance:e,amount:c})]}),s.jsx(d,{variant:"secondary",size:"sm",className:"w-full mb-1",asChild:!0,children:s.jsx(r,{to:"/records",children:"View Transaction Records"})}),s.jsx(d,{variant:"secondary",size:"sm",onClick:g,className:"w-full",children:n?s.jsxs(s.Fragment,{children:["Hide",s.jsx(l,{name:"ChevronUp"})]}):s.jsxs(s.Fragment,{children:["Breakdown",s.jsx(l,{name:"ChevronDown"})]})})]}),s.jsx(v,{balance:e,showBreakdown:n})]}),i&&(C=c,!C.every((e=>0===e)))&&s.jsx(y,{amount:c,qualifiedId:w,balance:e})]});var C}function k({balance:e,amount:r,setLoading:n,setReactMessage:t}){const c=a.useCallback((e=>{t(s.jsx(C,{message:e.message}))}),[t]),d=a.useCallback((({data:e})=>{n(!1),t(s.jsx(w,{message:e}))}),[n,t]);return s.jsx(j,{endpoint:i,default_values:{receiver:(e.is_aa?"AA:":"")+e.id,amount:g(r),note:e.is_aa?"IGNORE":"DEPOSIT"},label:s.jsxs("span",{className:"transform rotate-90 flex items-center",children:[s.jsx(l,{name:"ChevronUp"}),"Withdraw"]}),handle_error:c,classes:"w-10 p-0 row-span-full h-50 flex items-center justify-center bg-destructive",handle_response:d})}function w({message:e}){return s.jsxs(s.Fragment,{children:[s.jsx(d,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(r,{to:"/guild_member",children:[s.jsx(l,{name:"ChevronLeft",className:"h-4 w-4"}),"Back"]})}),s.jsxs("div",{className:(e.status_success?"bg-green-100/10 text-green-500 border-green-400":"bg-red-100/10 text-red-500 border-red-400")+" border-2 px-4 py-3 relative",role:"alert",children:[s.jsx("strong",{className:"font-bold",children:"Success!"}),s.jsxs("span",{className:"block sm:inline",children:[" ",e.status_msg]}),s.jsxs("ul",{className:"mt-2 list-disc list-inside",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Status:"})," ",e.status]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Receiver: "}),s.jsxs(r,{className:"text-blue-500 hover:text-blue-600 underline",to:`https://politicsandwar.com/${e.receiver_is_aa?"alliance":"nation"}/id=${e.receiver_id}`,children:[e.receiver_name," / ",e.receiver_is_aa?"AA:":"nation:",e.receiver_id]})]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Amount:"})," ",g(e.amount)]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Note:"})," ",e.note]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Messages:"}),s.jsx("ul",{className:"list-disc list-inside ml-4",children:e.messages.map(((e,a)=>s.jsx("li",{children:e},a)))})]})]})]})]})}function C({message:e}){return s.jsxs(s.Fragment,{children:[s.jsx(d,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(r,{to:"/guild_member",children:[s.jsx(l,{name:"ChevronLeft",className:"h-4 w-4"}),"Back"]})}),s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:[s.jsx("strong",{className:"font-bold",children:"Error!"}),s.jsxs("span",{className:"block sm:inline",children:[" ",e]})]})]})}export{C as TransferError,w as TransferSuccess,k as WithdrawForm,u as default};
