import{r as e,j as t}from"./index-dWbV2YWN.js";import{B as a}from"./button-BYsJFizr.js";import{I as s}from"./input-hcSfkvL2.js";import{L as n,T as o,M as r}from"./MarkupRenderer-CugZClZz.js";import{D as i,F as l}from"./endpoints-C8SDwtyd.js";import{u as c}from"./copytoclipboard-Cy7DO2po.js";function m({commands:m,prefix:d}){const{showDialog:p}=c(),[f,h]=e.useState(""),[g,b]=e.useState(m),[x,j]=e.useState(!1),[y,w]=e.useState((()=>({}))),[S]=e.useState((()=>{const e=new Map;for(const t of m){const a=t.getArguments(),s=new Set;for(const e of a)for(const t of e.getTypeBreakdown().getAllChildren())s.add(t);for(const t of s)e.set(t,(e.get(t)||0)+1)}return Array.from(e.entries()).sort().map((([e,t])=>({label:`${e} (${t})`,value:e})))})),[v]=e.useState((()=>{const e=new Map;for(const t of m)if(t.command.annotations&&t.command.annotations.role)for(const a of t.command.annotations.role.value)e.set(a,(e.get(a)||0)+1);return Array.from(e.entries()).sort().map((([e,t])=>({label:`${e} (${t})`,value:e})))})),C=e.useCallback(((e,t)=>{const a=e.toLowerCase(),s=i(a),n=new Set(a.split(" ")),o=m.map((e=>({cmd:e,similarityScore:l(a,s,n,e)}))).filter((({cmd:e,similarityScore:a})=>{const s=Object.values(t).every((t=>t(e)));return a>0&&s})).sort(((e,t)=>t.similarityScore-e.similarityScore)).map((({cmd:e})=>e));b(o)}),[m,b]),N=e.useCallback((e=>{const t=e.currentTarget.value;h(t),C(t,y)}),[y,C]),k=e.useCallback((()=>{j((e=>!e))}),[j]),A=e.useCallback(((e,t)=>{const a=new Set(t.split(",")),s={...y};if(t){const e=e=>{if(!e.command.annotations||!e.command.annotations.role)return!1;const t=e.command.annotations.role;if(t.root)return!1;for(const s of t.value)if(a.has(s))return!0;return!1};s.hasrole=e,w(s)}else delete s.hasrole,w(s);C(f,s)}),[y,w,f,C]),R=e.useCallback(((e,t)=>{const a={...y};if("1"===t||"-1"===t){const e="1"===t,s=t=>!!(t.command.arguments&&Object.values(t.command.arguments).length>0)===e;a.hasarg=s,w(a)}else delete a.hasarg,w(a);C(f,a)}),[y,w,f,C]),V=e.useCallback(((e,t)=>{const a=new Set(t.split(",")),s={...y};if(t){const e=e=>{if(!e.command.arguments)return!1;const t=new Set(e.getArguments().flatMap((e=>e.getTypeBreakdown().getAllChildren())));for(const s of a)if(!t.has(s))return!1;return!0};s.hasargs=e,w(s)}else delete s.hasargs,w(s);C(f,s)}),[y,w,f,C]);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex w-full items-center pb-1",children:[t.jsx(s,{className:"relative grow",type:"search",placeholder:"Description",onKeyUp:N}),t.jsxs(a,{type:"button",size:"sm",variant:"outline",onClick:k,children:["Filter ",x?"▲":"▼"]})]}),v.length>0&&S.length>0&&t.jsxs("div",{className:"bg-secondary "+(x?"mb-1 p-1 pt-0":"invisible w-0 h-0 p-0 m-0"),children:["Whitelisted",t.jsx(u,{annotation:"whitelist",filter:f,map:y,set:w,update:C}),"Whitelisted Coalition",t.jsx(u,{annotation:"coalition",filter:f,map:y,set:w,update:C}),"Requires Alliance",t.jsx(u,{annotation:"isalliance",filter:f,map:y,set:w,update:C}),"Requires API",t.jsx(u,{annotation:"hasapi",filter:f,map:y,set:w,update:C}),"Requires Offshore",t.jsx(u,{annotation:"hasoffshore",filter:f,map:y,set:w,update:C}),"Restricted Guild",t.jsx(u,{annotation:"isguild",filter:f,map:y,set:w,update:C}),"Roles",t.jsx(u,{annotation:"role",filter:f,map:y,set:w,update:C}),"Require Roles (Any)",t.jsx(n,{argName:"hasrole",options:v,isMulti:!0,initialValue:"",setOutputValue:A}),"Has Arguments:",t.jsx(o,{argName:"hasarg",initialValue:"0",setOutputValue:R}),"Require Arguments (All):",t.jsx(n,{argName:"reqarg",options:S,isMulti:!0,initialValue:"",setOutputValue:V})]}),g&&g.length>0&&t.jsxs("table",{className:"table-auto w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-card",children:[t.jsx("th",{className:"px-4 py-2",children:"Command"}),t.jsx("th",{className:"px-4 py-2",children:"Description"})]})}),t.jsx("tbody",{children:g.map((e=>t.jsxs("tr",{children:[t.jsx("td",{className:"px-1 py-1 border-2 border-blue-500 border-opacity-75 md:border-opacity-50 bg-secondary",children:t.jsxs("a",{href:`#command/${e.name}`,className:"font-bold no-underline hover:underline text-blue-600 dark:text-blue-500",children:[d,e.name]})}),t.jsx("td",{className:"px-1 py-1 border-2 border-blue-500 border-opacity-75 md:border-opacity-50 bg-secondary",children:t.jsx(r,{content:e.getDescShort()})})]},e.name)))})]})]})}function u({annotation:a,filter:s,map:n,set:r,update:i}){const l=e.useCallback(((e,t)=>{const o={...n};if("1"===t||"-1"===t){const e="1"===t,s=t=>!(!t.command.annotations||!t.command.annotations[a])===e;o[a]=s,r(o)}else delete o[a],r(o);i(s,o)}),[a,s,n,r,i]);return t.jsx(o,{argName:"ignore",initialValue:"0",setOutputValue:l})}export{m as C};
