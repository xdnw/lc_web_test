import{r as e,j as s,R as r,h as t,L as a}from"./index-dWbV2YWN.js";import{c as n,b as l}from"./StateUtil-moXfkR8g.js";import{B as o,d as i,c as u}from"./button-BYsJFizr.js";import{u as c}from"./copytoclipboard-Cy7DO2po.js";import{u as d}from"./bulkwrapper-lVatfgrI.js";import{A as m,a as p}from"./MarkupRenderer-CugZClZz.js";import{y as h}from"./endpoints-C8SDwtyd.js";import{u as j}from"./useQuery-DQU7waJ6.js";import{L as g}from"./loading-DZKuFaBE.js";const b=r.memo((({arg:e,setOutputValue:r})=>s.jsxs("div",{className:"relative",children:[s.jsx(m,{arg:e}),s.jsx("div",{className:"mb-1 bg-accent border border-slate-500 border-opacity-50 rounded-b-sm rounded-tr-sm",children:s.jsx(p,{argName:e.name,breakdown:e.getTypeBreakdown(),min:e.arg.min,max:e.arg.max,initialValue:"",setOutputValue:r})})]})),((e,s)=>e.arg.name===s.arg.name));function f({endpoint:r,message:t,default_values:a,showArguments:n,label:l,handle_error:o,classes:i,handle_response:u,children:m}){const{showDialog:p}=c(),h=e.useMemo((()=>{const e=[];for(const[s,t]of Object.entries(r.endpoint.args))t.arg.optional||a&&Object.prototype.hasOwnProperty.call(a,s)||e.push(s);return e}),[r,a]),j=e.useCallback((e=>{o?o(e):p("Error",e.message)}),[o,p]),g=d(a?Object.fromEntries(Object.entries(a).filter((([e,s])=>void 0!==s))):{}),f=e.useMemo((()=>h&&0!==h.length||n&&0!==n.length?Object.values(r.endpoint.args).filter((e=>!g||!Object.prototype.hasOwnProperty.call(g,e.name))):[]),[r,g,h,n]),v=e.useCallback((e=>0===f.length?null:s.jsxs(s.Fragment,{children:[f.map(((r,t)=>s.jsx(b,{arg:r,setOutputValue:e.setOutputValue},t))),s.jsx("hr",{className:"my-2"})]})),[f]);return s.jsx(x,{requireLogin:!1,required:h,message:t,endpoint:r,label:l,default_values:g,form_inputs:v,handle_error:j,handle_response:u,classes:i,children:e=>m?m(e):null})}function x({requireLogin:r=!1,message:i,endpoint:u,label:c="submit",required:d=[],default_values:m,form_inputs:p,handle_error:h,classes:j,handle_response:g,children:b}){const[f]=e.useState((()=>m&&Object.keys(m).length?n(m):l())),x=e.useMemo((()=>s.jsxs(s.Fragment,{children:[i,i&&d&&d.length>0&&s.jsx("hr",{className:"my-2"})]})),[i,d]),y=e.useMemo((()=>s.jsx(v,{endpoint:u,store:f,label:c,required:d,handle_error:h,handle_response:g,classes:j,children:e=>b?b(e):null})),[u,f,c,d,h,g,j,b]);return r&&!t()?s.jsxs(s.Fragment,{children:["Please login first",s.jsx("br",{}),s.jsx(o,{variant:"outline",size:"sm",className:"border-red-800/70",asChild:!0,children:s.jsx(a,{to:"/home",children:"Login"})})]}):s.jsxs(s.Fragment,{children:[x,p&&s.jsx(p,{setOutputValue:f((e=>e.setOutput))}),y]})}function v({store:r,endpoint:t,label:a,required:n,handle_error:l,classes:c,handle_response:d,children:m}){const[p,b]=e.useState((()=>{const e=r.getState().output;return n?n.filter((s=>!e[s])):[]})),[f,x]=e.useState(r.getState().output),[v,y]=e.useState(0),O=e.useRef(!0);e.useEffect((()=>{const e=r.subscribe((e=>e.output),((e,s)=>{if(n){const s=n.filter((s=>!e[s]));b((e=>i(e,s)?e:s))}}));return()=>e()}),[r,n,b]);const{data:_,isFetching:w,refetch:N}=j({...h(t.endpoint,f||{},void 0,10),enabled:!1});e.useEffect((()=>{O.current?O.current=!1:f&&v>0&&(y(0),N().then((e=>{const s=e.data,r=e.error??s.error;r?l&&l("string"==typeof r?new Error(r):r):s.data?d&&d(e.data):l&&l(new Error("No data returned"))})).catch((e=>{l&&l(e)})))}),[f,v,N,l,d]);const k=e.useCallback((()=>{const e=r.getState().output;x(e),y((e=>e+1))}),[r]),S=e.useMemo((()=>_&&m?m(_):null),[_,m]),F=e.useMemo((()=>s.jsx(o,{variant:"destructive",size:"sm",className:u("border-red-800/70 relative","me-1",{"disabled cursor-wait":w},c),onClick:k,disabled:w,children:s.jsxs("span",{className:"flex items-center justify-center w-full",children:[s.jsx("span",{className:w?"invisible":"visible",children:a}),w&&s.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx(g,{size:3,variant:"ripple"})})]})})),[w,k,a,c]);return p.length?s.jsxs("p",{children:["Please provide a value for ",s.jsx("kbd",{children:p.join(", ")})]}):s.jsxs(s.Fragment,{children:[S,F]})}r.memo(x,i);export{f as A};
